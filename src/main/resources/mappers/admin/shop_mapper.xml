<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shop">

    <select id="selectShopList" parameterType="com.dchans.api.admin.dto.shop.ShopDto$ShopRequestDto" resultType="com.dchans.api.admin.dto.shop.ShopDto$ShopResponseDto">
        select seq, name, format(price, 0) as price,
            to_char(created_at,'YYYY-MM-DD') as createdAt
        from shop
        order by created_at desc
        limit #{pageSize} offset #{offset}
    </select>

    <select id="selectShopCount" parameterType="com.dchans.api.admin.dto.shop.ShopDto$ShopRequestDto" resultType="int">
        select count(*) from shop
    </select>

    <select id="selectShopDetail" parameterType="com.dchans.api.admin.dto.shop.ShopDto$ShopRequestDto" resultType="com.dchans.api.admin.dto.shop.ShopDto$ShopResponseDto">
        select
            seq,
            name,
            price
        from shop
        where seq = #{seq}
    </select>

    <select id="selectShopImageList" parameterType="com.dchans.api.admin.dto.shop.ShopDto$ShopRequestDto" resultType="String">
        select image_path
        from common_image
        where parent_seq = #{seq}
        and type = 'shop'
    </select>

    <delete id="deleteShop">
        delete from shop
        where 1 = 1
        and seq in
        <foreach collection="seqList" item="seq" open="(" close=")" separator=",">
            #{seq}
        </foreach>
    </delete>

    <insert id="insertShop" parameterType="com.dchans.api.admin.dto.shop.ShopDto$ShopCreateDto" useGeneratedKeys="true" keyProperty="seq">
        insert into shop (name, price)
        values
            (
            #{name},
            #{price}
            )
    </insert>

    <update id="updateShop" parameterType="com.dchans.api.admin.dto.shop.ShopDto$ShopUpdateDto">
        update shop set name = #{name}, price = #{price}
        where seq = #{seq}
    </update>

</mapper>